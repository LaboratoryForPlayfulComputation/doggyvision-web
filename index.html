<!DOCTYPE html>
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<script src='imgprocess.js'></script>
<head>
  <link rel="stylesheet" href="style.css">
</head>
<body style='margin : 0px; overflow: scroll; font-family: Monospace;'><div style='position: absolute; top: 10px; width:100%; text-align: center; z-index: 1;'>

  <center>
    <div style="margin: 10px;"><strong>DOGGY VISION</strong></div>
    <div>
      <video id="video" autoplay="true" style="display:none;"></video>
      <div style="display: inline-block;">
        <canvas id="canvas" style="width:640px; height:480px; "></canvas><br>
        <b>You</b>
      </div>
      <div style="display: inline-block;">
        <canvas id="canvas2" style="width:640px; height:480px;"></canvas><br>
        <b>Your dog</b>
      </div>
    </div>
    <br>
    <div>
      Deuteranopia<br>
      <label class="switch">
        <input type="checkbox" onclick="deuteranopiaChanged()" checked>
        <span class="slider round"></span>
      </label>
      <br>
      Brightness Discrimination<br>
      <label class="switch">
        <input type="checkbox" onclick="brightnessDiscriminationChanged()" checked>
        <span class="slider round"></span>
      </label>
      <br>
      Visual Acuity<br>
      <input type="range" min="0" max="5" value="0" id="myRange" onchange="visualAcuityChanged()">
      <br>
      <br>
      Image processing algorithm taken from <a href="https://dog-vision.com/">https://dog-vision.com/</a>
    </div>
  </center>

<script type="text/javascript">

    var video, canvas, context, imageData, deuteranopia, brightnessDiscrimination, visualAcuity;
    var deuteranopia = true;
    var brightnessDiscrimination = true;
    var visualAcuity = 0;

    function deuteranopiaChanged(){
      deuteranopia = !deuteranopia;
    }

    function brightnessDiscriminationChanged(){
      brightnessDiscrimination = !brightnessDiscrimination;
    }

    function visualAcuityChanged(){
      visualAcuity = document.getElementById("myRange").value;
    }

    function onLoad(){
      video = document.getElementById("video");
      canvas = document.getElementById("canvas");
      canvas2 = document.getElementById("canvas2");
      context = canvas.getContext("2d");
      context2 = canvas2.getContext("2d");
    
      canvas.width = parseInt(canvas.style.width);
      canvas.height = parseInt(canvas.style.height);
      canvas2.width = parseInt(canvas2.style.width);
      canvas2.height = parseInt(canvas2.style.height);      
      
      navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
      if (navigator.getUserMedia){
        function successCallback(stream){
          if (window.webkitURL) {
            video.src = window.webkitURL.createObjectURL(stream);
          } else if (video.mozSrcObject !== undefined) {
            video.mozSrcObject = stream;
          } else {
            video.src = stream;
          }
        }
        function errorCallback(error){
        }
        navigator.getUserMedia({video: true}, successCallback, errorCallback);
        requestAnimationFrame(tick);
      }
    }
    
    function tick(){
      requestAnimationFrame(tick);
      if (video.readyState === video.HAVE_ENOUGH_DATA){
        snapshot();
      }
    }

    function snapshot(){
      context.drawImage(video, 0, 0, canvas.width, canvas.height);
      imageData = context.getImageData(0, 0, canvas.width, canvas.height);
      //imageData = imgprocess(imageData, true, false, 2);
      context2.putImageData(imgprocess(imageData, deuteranopia, brightnessDiscrimination, visualAcuity), 0, 0);
      //context.drawImage(video, 0, 0, canvas.width, canvas.height);
    }
          
    window.onload = onLoad;


</script>

</body>
